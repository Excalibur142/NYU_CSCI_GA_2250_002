<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0057)https://cs.nyu.edu/courses/fall21/CSCI-GA.2250-002/nyuenc -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Lab 3: Encoder</title>
<meta name="generator" content="Org Mode">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="./Lab 3_ Encoder_files/htmlize.css">
<link rel="stylesheet" type="text/css" href="./Lab 3_ Encoder_files/readtheorg.css">
<script src="./Lab 3_ Encoder_files/jquery.min.js.download"></script><style></style>
<script src="./Lab 3_ Encoder_files/bootstrap.min.js.download"></script>
<script type="text/javascript" src="./Lab 3_ Encoder_files/jquery.stickytableheaders.min.js.download"></script>
<script type="text/javascript" src="./Lab 3_ Encoder_files/readtheorg.js.download"></script>
<style>pre.src{background:#fafafa;color:#383a42;}</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
<script async="" src="./Lab 3_ Encoder_files/adblocker-chromeglobalinjectjs.js.download"></script></head>
<body>
<div id="content"><div id="toggle-sidebar"><a href="https://cs.nyu.edu/courses/fall21/CSCI-GA.2250-002/nyuenc#table-of-contents"><h2>Table of Contents</h2></a></div>
<h1 class="title">Lab 3: Encoder</h1>
<div id="table-of-contents">
<h2>Table of Contents<a class="close-sidebar" href="https://cs.nyu.edu/courses/fall21/CSCI-GA.2250-002/nyuenc#">Close</a></h2>
<div id="text-table-of-contents">
<ul class="nav">
<li><a href="https://cs.nyu.edu/courses/fall21/CSCI-GA.2250-002/nyuenc#introduction">Introduction</a></li>
<li><a href="https://cs.nyu.edu/courses/fall21/CSCI-GA.2250-002/nyuenc#objectives">Objectives</a></li>
<li><a href="https://cs.nyu.edu/courses/fall21/CSCI-GA.2250-002/nyuenc#runlengthencoding">Run-length encoding</a></li>
<li><a href="https://cs.nyu.edu/courses/fall21/CSCI-GA.2250-002/nyuenc#milestone1sequentialrle">Milestone 1: sequential RLE</a></li>
<li><a href="https://cs.nyu.edu/courses/fall21/CSCI-GA.2250-002/nyuenc#milestone2parallelrle">Milestone 2: parallel RLE</a>
<ul>
<li><a href="https://cs.nyu.edu/courses/fall21/CSCI-GA.2250-002/nyuenc#howtoparallelizetheencoding">How to parallelize the encoding</a></li>
</ul>
</li>
<li><a href="https://cs.nyu.edu/courses/fall21/CSCI-GA.2250-002/nyuenc#compiling">Compiling</a></li>
<li><a href="https://cs.nyu.edu/courses/fall21/CSCI-GA.2250-002/nyuenc#testing">Testing</a>
<ul>
<li><a href="https://cs.nyu.edu/courses/fall21/CSCI-GA.2250-002/nyuenc#strace">strace</a></li>
<li><a href="https://cs.nyu.edu/courses/fall21/CSCI-GA.2250-002/nyuenc#valgrind">Valgrind</a></li>
</ul>
</li>
<li><a href="https://cs.nyu.edu/courses/fall21/CSCI-GA.2250-002/nyuenc#theautograder">The autograder</a></li>
<li><a href="https://cs.nyu.edu/courses/fall21/CSCI-GA.2250-002/nyuenc#submission">Submission</a></li>
<li><a href="https://cs.nyu.edu/courses/fall21/CSCI-GA.2250-002/nyuenc#rubric">Rubric</a></li>
<li><a href="https://cs.nyu.edu/courses/fall21/CSCI-GA.2250-002/nyuenc#tips">Tips</a>
<ul>
<li><a href="https://cs.nyu.edu/courses/fall21/CSCI-GA.2250-002/nyuenc#dontprocrastinate">Don’t procrastinate</a></li>
<li><a href="https://cs.nyu.edu/courses/fall21/CSCI-GA.2250-002/nyuenc#howtoparsecommandlineoptions">How to parse command-line options</a></li>
<li><a href="https://cs.nyu.edu/courses/fall21/CSCI-GA.2250-002/nyuenc#howtoaccesstheinputfileefficiently">How to access the input file efficiently</a></li>
<li><a href="https://cs.nyu.edu/courses/fall21/CSCI-GA.2250-002/nyuenc#howtodebug">How to debug</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-introduction" class="outline-2">
<h2 id="introduction">Introduction</h2>
<div class="outline-text-2" id="text-introduction">
<p>
<b>Data compression</b> is the process of encoding information using fewer bits than the original representation. <b>Run-length encoding (RLE)</b> is a simple yet effective compression algorithm: repeated data are stored as a single data and the count. In this lab, you will build a parallel run-length encoder called <b>Not Your Usual ENCoder</b>, or <code>nyuenc</code> for short.
</p>
</div>
</div>

<div id="outline-container-objectives" class="outline-2">
<h2 id="objectives">Objectives</h2>
<div class="outline-text-2" id="text-objectives">
<p>
Through this lab, you will:
</p>

<ul class="org-ul">
<li>Familiarize yourself with multithreaded programming using POSIX threads.</li>
<li>Learn how to implement a thread pool using mutexes and condition variables.</li>
<li>Learn how to use a thread pool to parallelize a program.</li>
<li>Get a better understanding of key IPC concepts and issues.</li>
<li>Be a better C programmer and be better prepared for your future technical job interviews. In particular, the string encoding technique that you will practice in this lab frequently appears in interview questions.</li>
</ul>
</div>
</div>

<div id="outline-container-runlengthencoding" class="outline-2">
<h2 id="runlengthencoding">Run-length encoding</h2>
<div class="outline-text-2" id="text-runlengthencoding">
<p>
Run-length encoding (RLE) is quite simple. When you encounter <i>n</i> characters of the same type in a row, the encoder (<code>nyuenc</code>) will turn that into a single instance of the character followed by the count <i>n</i>.
</p>

<p>
For example, a file with the following contents:
</p>

<div class="org-src-container">
<pre class="src src-text">aaaaaabbbbbbbbba
</pre>
</div>

<p>
would be encoded (logically, as the numbers would be in binary format) as:
</p>

<div class="org-src-container">
<pre class="src src-text">a6b9a1
</pre>
</div>

<p>
Note that the exact format of the encoded file is important. You will store the character in ASCII and the count as a <b>1-byte unsigned integer in binary format</b>. In other words, the output is actually:
</p>

<div class="org-src-container">
<pre class="src src-text">a\x06b\x09a\x01
</pre>
</div>

<p>
In this example, the original file is 16 bytes, and the encoded file is 6 bytes.
</p>

<p>
<i>For simplicity, you can assume that no character will appear more than 255 times in a row. In other words, you can safely store the count in one byte.</i>
</p>
</div>
</div>

<div id="outline-container-milestone1sequentialrle" class="outline-2">
<h2 id="milestone1sequentialrle">Milestone 1: sequential RLE</h2>
<div class="outline-text-2" id="text-milestone1sequentialrle">
<p>
You will first implement <code>nyuenc</code> as a single-threaded program. The encoder reads from one or more files specified as command-line arguments and writes to <code>STDOUT</code>. Thus, the typical usage of <code>nyuenc</code> would use shell redirection to write the encoded output to a file.
</p>

<p>
Note that you can use <code>xxd</code> to inspect a file in binary format.
</p>

<p>
For example, let’s encode the aforementioned file.
</p>

<div class="org-src-container">
<pre class="src src-text">$ echo -n "aaaaaabbbbbbbbba" &gt; file.txt
$ xxd file.txt
0000000: 6161 6161 6161 6262 6262 6262 6262 6261  aaaaaabbbbbbbbba
$ ./nyuenc file.txt &gt; file.enc
$ xxd file.enc
0000000: 6106 6209 6101                           a.b.a.
</pre>
</div>

<p>
If multiple files are passed to <code>nyuenc</code>, they will be <b>concatenated</b> and encoded into a single compressed output. For example:
</p>

<div class="org-src-container">
<pre class="src src-text">$ echo -n "aaaaaabbbbbbbbba" &gt; file.txt
$ xxd file.txt
0000000: 6161 6161 6161 6262 6262 6262 6262 6261  aaaaaabbbbbbbbba
$ ./nyuenc file.txt file.txt &gt; file2.enc
$ xxd file2.enc
0000000: 6106 6209 6107 6209 6101                 a.b.a.b.a.
</pre>
</div>

<p>
Note that the last <code>a</code> in the first file and the leading <code>a</code>’s in the second file are merged.
</p>

<p>
<i>For simplicity, you can assume that there are no more than 100 files, and the total size of all files is no more than 1GB.</i>
</p>
</div>
</div>

<div id="outline-container-milestone2parallelrle" class="outline-2">
<h2 id="milestone2parallelrle">Milestone 2: parallel RLE</h2>
<div class="outline-text-2" id="text-milestone2parallelrle">
<p>
Next, you will parallelize the encoding using POSIX threads. In particular, you will implement a <a href="https://en.wikipedia.org/wiki/Thread_pool">thread pool</a> for executing encoding tasks.
</p>

<p>
You should use mutexes, condition variables, or semaphores to realize proper synchronization among threads. <b>Your code must be free of race conditions. You must not perform busy waiting, and you must not use <code>sleep()</code>, <code>usleep()</code>, or <code>nanosleep()</code>.</b>
</p>

<p>
Your <code>nyuenc</code> will take an optional command-line option <code>-j jobs</code>, which specifies the number of worker threads. (If no such option is provided, it runs sequentially.)
</p>

<p>
For example:
</p>

<div class="org-src-container">
<pre class="src src-text">$ time ./nyuenc file.txt &gt; /dev/null
real    0m0.527s
user    0m0.475s
sys     0m0.233s
$ time ./nyuenc -j 3 file.txt &gt; /dev/null
real    0m0.191s
user    0m0.443s
sys     0m0.179s
</pre>
</div>

<p>
You can see the difference in running time between the sequential version and the parallel version.
</p>
</div>

<div id="outline-container-howtoparallelizetheencoding" class="outline-3">
<h3 id="howtoparallelizetheencoding">How to parallelize the encoding</h3>
<div class="outline-text-3" id="text-howtoparallelizetheencoding">
<p>
Think about what can be done in parallel and what must be done serially by a single thread.
</p>

<p>
Also, think about how to divide the encoding task into smaller pieces. Note that the input files may vary greatly in size. Will all the worker threads be fully utilized?
</p>

<p>
Here is an illustration of a thread pool from <a href="https://en.wikipedia.org/wiki/Thread_pool">Wikipedia</a>:
</p>

<img src="./Lab 3_ Encoder_files/Thread_pool.svg">

<p>
At the beginning of your program, you should create a pool of worker threads (the green boxes in the figure above). The number of threads is specified by the command-line argument <code>-j jobs</code>.
</p>

<p>
You should divide the input data into fixed-size (4KB) chunks and submit the tasks (the blue circles in the figure above) to the task queue, where each task would encode a chunk. Whenever a worker thread becomes available, it would execute the next task in the task queue.
</p>

<p>
The main thread should collect the results (the yellow circles in the figure above) and write them to <code>STDOUT</code>. Note that you may need to stitch the chunk boundaries. For example, if the previous chunk ends with <code>aaaaa</code>, and the next chunk starts with <code>aaa</code>, instead of writing <code>a5a3</code>, you should write <code>a8</code>.
</p>

<p>
It is important that you synchronize the threads properly so that there are no deadlocks or race conditions. In particular, there are two things that you need to consider carefully:
</p>

<ul class="org-ul">
<li>The worker thread should wait until there is a task to do.</li>
<li>The main thread should wait until a task has been completed so that it can collect the result.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-compiling" class="outline-2">
<h2 id="compiling">Compiling</h2>
<div class="outline-text-2" id="text-compiling">
<p>
We will grade your submission on one of the <a href="https://cims.nyu.edu/webapps/content/systems/resources/computeservers/">compute servers</a>, which runs CentOS Linux release 7.9.2009. We will compile your program using <code>gcc</code> 9.2.0. You need to run the following command to load it:
</p>

<div class="org-src-container">
<pre class="src src-text">$ module load gcc-9.2
</pre>
</div>

<p>
You must provide a <code>Makefile</code>, and by running <code>make</code>, it should generate an executable file named <code>nyuenc</code> in the current working directory. Note that you need to add the compiler option <code>-pthread</code>.
</p>

<p>
<i>For those of you who choose to use C++, you are <b>not</b> allowed to include &lt;atomic&gt;, &lt;condition_variable&gt;, &lt;future&gt;, &lt;mutex&gt;, or &lt;thread&gt;.</i>
</p>
</div>
</div>

<div id="outline-container-testing" class="outline-2">
<h2 id="testing">Testing</h2>
<div class="outline-text-2" id="text-testing">
<p>
Your code will first be measured for <b>correctness</b>. Parallelism means nothing if it cannot encode files correctly.
</p>

<p>
If you pass the correctness tests, your code will be tested for <b>performance</b>. Higher performance will lead to better scores.
</p>
</div>

<div id="outline-container-strace" class="outline-3">
<h3 id="strace">strace</h3>
<div class="outline-text-3" id="text-strace">
<p>
We will use <code>strace</code> to examine the system calls you have invoked. You will suffer from <b>severe score penalties</b> if you call <code>clone()</code> too many times, which indicates that you do not use a thread pool properly, or if you call <code>nanosleep()</code>, which indicates that you do not have proper synchronization.
</p>

<p>
On the other hand, you can expect to find many <code>futex()</code> invocations in the <code>strace</code> log. They are used for synchronization.
</p>

<p>
You can use the following command to run your program under <code>strace</code> and dump the log to <code>strace.txt</code>:
</p>

<div class="org-src-container">
<pre class="src src-text">$ strace ./nyuenc -j 3 file.txt &gt; /dev/null 2&gt; strace.txt
</pre>
</div>
</div>
</div>

<div id="outline-container-valgrind" class="outline-3">
<h3 id="valgrind">Valgrind</h3>
<div class="outline-text-3" id="text-valgrind">
<p>
We will use two Valgrind tools, namely <a href="https://www.valgrind.org/docs/manual/hg-manual.html">Helgrind</a> and <a href="https://valgrind.org/docs/manual/drd-manual.html">DRD</a>, to detect thread errors in your code. <b>Both should report 0 errors from 0 contexts</b>.
</p>

<p>
You can use the following command to run your program under Helgrind:
</p>

<div class="org-src-container">
<pre class="src src-text">$ valgrind --tool=helgrind --read-var-info=yes ./nyuenc -j 3 file.txt &gt; /dev/null
==12345== Helgrind, a thread error detector
==12345== Copyright (C) 2007-2017, and GNU GPL'd, by OpenWorks LLP et al.
==12345== Using Valgrind-3.15.0 and LibVEX; rerun with -h for copyright info
==12345== Command: ./nyuenc -j 3 file.txt
==12345==
==12345==
==12345== Use --history-level=approx or =none to gain increased speed, at
==12345== the cost of reduced accuracy of conflicting-access information
==12345== For lists of detected and suppressed errors, rerun with: -s
==12345== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 240 from 89)
</pre>
</div>

<p>
You can use the following command to run your program under DRD:
</p>

<div class="org-src-container">
<pre class="src src-text">$ valgrind --tool=drd --read-var-info=yes ./nyuenc -j 3 file.txt &gt; /dev/null
==12345== drd, a thread error detector
==12345== Copyright (C) 2006-2017, and GNU GPL'd, by Bart Van Assche.
==12345== Using Valgrind-3.15.0 and LibVEX; rerun with -h for copyright info
==12345== Command: ./nyuenc -j 3 file.txt
==12345==
==12345==
==12345== For lists of detected and suppressed errors, rerun with: -s
==12345== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 139 from 11)
</pre>
</div>

<p>
Note that Valgrind is very slow; so you should only test it with small files.
</p>
</div>
</div>
</div>

<div id="outline-container-theautograder" class="outline-2">
<h2 id="theautograder">The autograder</h2>
<div class="outline-text-2" id="text-theautograder">
<p>
Please download the <a href="https://cs.nyu.edu/courses/fall21/CSCI-GA.2250-002/nyuenc-autograder.tar.xz">autograder</a> to test your program. Note that the test cases are not exhaustive. However, if you can’t pass these cases, you can’t expect to pass the final grading.
</p>
</div>
</div>

<div id="outline-container-submission" class="outline-2">
<h2 id="submission">Submission</h2>
<div class="outline-text-2" id="text-submission">
<p>
You will submit an archive containing all files needed to compile <code>nyuenc</code>. You can do so with the following command:
</p>

<div class="org-src-container">
<pre class="src src-text">$ tar cvJf nyuenc-Your_NetID.tar.xz Makefile *.h *.c
</pre>
</div>
</div>
</div>

<div id="outline-container-rubric" class="outline-2">
<h2 id="rubric">Rubric</h2>
<div class="outline-text-2" id="text-rubric">
<p>
The total of this lab is 100 points, mapped to 15% of your final grade of this course.
</p>

<ul class="org-ul">
<li>Meaningful submission that compiles successfully. (40 points)</li>
<li>Milestone 1.
<ul class="org-ul">
<li>Correctly encode one file. (10 points)</li>
<li>Correctly encode multiple files. (5 points)</li>
</ul></li>
<li>Milestone 2.
<ul class="org-ul">
<li>Correctness. (15 points)</li>
<li>Performance. (15 points)</li>
<li>Free of thread errors (<i>e.g.</i>, deadlocks, race conditions). (15 points)
<ul class="org-ul">
<li>For each error context reported by Helgrind or DRD (we will take the smaller of the two), there will be 5 points deduction.</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-tips" class="outline-2">
<h2 id="tips">Tips</h2>
<div class="outline-text-2" id="text-tips">
</div>
<div id="outline-container-dontprocrastinate" class="outline-3">
<h3 id="dontprocrastinate">Don’t procrastinate</h3>
<div class="outline-text-3" id="text-dontprocrastinate">
<p>
This lab requires significant programming effort. Therefore, <b>start as early as possible!</b> Don’t wait until the last week.
</p>
</div>
</div>

<div id="outline-container-howtoparsecommandlineoptions" class="outline-3">
<h3 id="howtoparsecommandlineoptions">How to parse command-line options</h3>
<div class="outline-text-3" id="text-howtoparsecommandlineoptions">
<p>
The <code>getopt()</code> function is useful for parsing command-line options such as <code>-j jobs</code>. Read its man page and example.
</p>
</div>
</div>

<div id="outline-container-howtoaccesstheinputfileefficiently" class="outline-3">
<h3 id="howtoaccesstheinputfileefficiently">How to access the input file efficiently</h3>
<div class="outline-text-3" id="text-howtoaccesstheinputfileefficiently">
<p>
You may have used <code>read()</code> or <code>fread()</code> before, but one particularly efficient way is to use <code>mmap()</code>, which maps a file into the memory address space. Then, you can efficiently access each byte of the input file via pointers. Read its man page and example.
</p>
</div>
</div>

<div id="outline-container-howtodebug" class="outline-3">
<h3 id="howtodebug">How to debug</h3>
<div class="outline-text-3" id="text-howtodebug">
<p>
Debugging multithreaded code can be frustrating, especially when it hangs. If you are using <code>gdb</code>, you can press <code>Ctrl-C</code> to stop the running program and use the following command to show what each thread is doing:
</p>

<div class="org-src-container">
<pre class="src src-text">(gdb) thread apply all backtrace
</pre>
</div>

<p>
Suppose you want to switch to Thread 2. You can type:
</p>

<div class="org-src-container">
<pre class="src src-text">(gdb) thread 2
</pre>
</div>

<p>
Then, you can use <code>up</code> and <code>down</code> to navigate through the stack frames and use <code>info locals</code> or <code>print</code> to examine variables.
</p>

<p>
A particularly useful command is <code>x</code>, which can show a portion of memory in binary format. For example, to examine the next 8 bytes pointed by <code>ptr</code>, you can use:
</p>

<div class="org-src-container">
<pre class="src src-text">(gdb) x/8bx ptr
</pre>
</div>

<p>
In addition, we have partnered with Undo to provide <a href="https://undo.io/free-educational-licenses/">free educational licenses</a> for the <a href="https://undo.io/solutions/products/udb/">UDB time travel debugger</a>. You can use <code>udb</code> in place of <code>gdb</code>. Here is a <a href="https://docs.undo.io/UDB-quickref.pdf">quick reference guide</a>. You can also read a tutorial on <a href="https://undo.io/resources/debugging-race-conditions-cpp/">debugging race conditions</a> using <code>udb</code>.
</p>

<p>
<i>This lab has borrowed some ideas from Prof. Arpaci-Dusseau.</i>
</p>
</div>
</div>
</div>
</div>


</body></html>